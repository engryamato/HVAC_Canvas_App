# SizeWise HVAC Canvas App: End-to-End User Journey

The following realistic walkthrough shows how a designer can lay out a simple office HVAC system with all Phase 0–5 capabilities. It traces every tool (Select, Room, Duct, Equipment), entity type (Room, Duct, Equipment), interaction pattern, validation flow, calculation feedback, and viewport control implemented in the canvas.

## Scenario: Condition a Small Open Office with a Perimeter Duct Run

1. **Launch the canvas from the dashboard** – Open the "Canvas Editor" and land on the workspace with the toolbar on the left, canvas in the center, zoom controls bottom-right, and the status bar showing cursor coordinates.【F:src/features/canvas/CanvasPage.tsx†L24-L78】【F:src/features/canvas/components/Toolbar.tsx†L65-L103】
2. **Review the default view** – The grid is visible and the view is centered; pan/zoom state comes from the viewport store defaults (pan 0,0 and 100% zoom).【F:src/features/canvas/store/viewportStore.ts†L33-L63】
3. **Pan to working area** – Hold **Space** and drag (or use the middle mouse button) to move the view; the viewport hook tracks panning and updates `panX/panY` so the grid and entities move under the cursor.【F:src/features/canvas/hooks/useViewport.ts†L16-L83】【F:src/features/canvas/components/CanvasContainer.tsx†L120-L176】
4. **Zoom in for detail** – Scroll the mouse wheel to zoom on the cursor or tap the zoom buttons; the viewport store clamps the zoom, and the canvas re-renders with the new scale and pan so geometry stays aligned.【F:src/features/canvas/hooks/useViewport.ts†L31-L72】【F:src/features/canvas/components/ZoomControls.tsx†L27-L90】【F:src/features/canvas/components/CanvasContainer.tsx†L184-L222】
5. **Use zoom-to-fit when needed** – If the layout drifts off-screen, trigger fit-to-content/reset from the zoom controls to recenter the scene (pan reset and zoom returns to default).【F:src/features/canvas/components/ZoomControls.tsx†L48-L83】【F:src/features/canvas/store/viewportStore.ts†L50-L111】
6. **Switch to the Room tool (R)** – Click the Room icon or press **R**; the toolbar updates the active tool and the canvas cursor becomes a crosshair for placement.【F:src/features/canvas/components/Toolbar.tsx†L42-L110】【F:src/features/canvas/tools/RoomTool.ts†L37-L67】
7. **Create the office boundary** – First click sets the starting corner, moving the mouse previews the rectangle with dashed edges, and the second click commits the room if it meets the 12" minimum in both directions (invalid sizes preview red).【F:src/features/canvas/tools/RoomTool.ts†L69-L119】【F:src/features/canvas/tools/RoomTool.ts†L137-L181】
8. **Name and sizing defaults** – The created room auto-names (Room 1, Room 2, …) and calculates area, volume, and required CFM based on default dimensions and ACH so the design starts with meaningful loads.【F:src/features/canvas/entities/roomDefaults.ts†L1-L70】【F:src/features/canvas/entities/roomDefaults.ts†L76-L118】
9. **Draw a perimeter duct run (D)** – Switch to the Duct tool (shortcut **D**). Click to start, drag to preview, and release to place a duct segment; previews turn red if the drawn length is under 1 ft, and finalized ducts carry length/rotation plus airflow labels.【F:src/features/canvas/tools/DuctTool.ts†L24-L95】【F:src/features/canvas/tools/DuctTool.ts†L104-L156】【F:src/features/canvas/renderers/DuctRenderer.ts†L17-L74】【F:src/features/canvas/renderers/DuctRenderer.ts†L96-L137】
10. **Inspect duct calculations and velocity risk** – Each duct stores shape, size, airflow, and derived area/velocity/friction. High velocities (derived from airflow ÷ area) surface in the calculated values so the Inspector can flag warnings when limits are exceeded.【F:src/features/canvas/entities/ductDefaults.ts†L17-L74】【F:src/core/schema/duct.schema.ts†L15-L66】
11. **Place diffusers and equipment (E)** – Activate the Equipment tool (shortcut **E**). Hover shows a preview box sized to the selected type defaults, and a click drops the unit centered on the pointer (e.g., diffusers along the duct, a fan/air handler near the supply).【F:src/features/canvas/tools/EquipmentTool.ts†L16-L86】【F:src/features/canvas/entities/equipmentDefaults.ts†L1-L69】【F:src/features/canvas/renderers/EquipmentRenderer.ts†L12-L71】
12. **Cycle equipment types** – Choose among hood, fan, diffuser, damper, or air_handler; each type uses its own default capacity, static pressure, and dimensions so the canvas preview matches expected footprint and ratings.【F:src/features/canvas/entities/equipmentDefaults.ts†L27-L69】【F:src/core/schema/equipment.schema.ts†L8-L73】
13. **Return to Select tool (V) for cleanup** – Press **V** to re-enter selection mode. Click once to select a single entity, Shift-click to add/remove items, or drag a marquee to multi-select grouped objects (rooms, ducts, equipment).【F:src/features/canvas/tools/SelectTool.ts†L25-L104】【F:src/features/canvas/tools/SelectTool.ts†L130-L189】
14. **See selection styling** – Selected rooms show thicker outlines and handles; ducts/equipment swap to blue strokes so it’s obvious what will be modified on the next action.【F:src/features/canvas/renderers/RoomRenderer.ts†L28-L78】【F:src/features/canvas/renderers/DuctRenderer.ts†L28-L54】【F:src/features/canvas/renderers/EquipmentRenderer.ts†L22-L47】
15. **Edit properties in the Inspector panel** – With entities selected, adjust dimensions, airflow, occupancy, or equipment capacity. Changes flow through the Zod schemas and calculators so derived metrics (room area/CFM, duct velocity/friction) refresh live; schema constraints (e.g., room sizes, duct shape requirements) surface validation errors until values are fixed.【F:src/core/schema/room.schema.ts†L12-L56】【F:src/features/canvas/entities/roomDefaults.ts†L20-L67】【F:src/core/schema/duct.schema.ts†L15-L66】【F:src/features/canvas/entities/ductDefaults.ts†L17-L74】【F:src/core/schema/equipment.schema.ts†L12-L74】
16. **Resolve validation issues** – If a room entry drops below 1" width/length or ACH above 100, the schema rejects it and the Inspector highlights the offending field; correcting the input clears the error and immediately updates calculations and render sizing.【F:src/core/schema/room.schema.ts†L23-L39】【F:src/features/canvas/tools/RoomTool.ts†L137-L181】
17. **Move entities precisely** – Drag selections directly on the canvas or nudge with arrow keys; holding **Shift** steps faster (1 ft vs 1 in) while respecting grid snap if enabled. Multi-select moves all chosen items together.【F:src/features/canvas/tools/SelectTool.ts†L56-L98】【F:src/features/canvas/tools/SelectTool.ts†L155-L217】
18. **Duplicate for repetitive layouts** – Press **Ctrl+D** with one or more entities selected to clone them offset from the originals, keeping types and properties intact so you can rapidly place identical diffusers or rooms.【F:src/features/canvas/tools/SelectTool.ts†L118-L149】
19. **Delete mistakes quickly** – Hit **Delete/Backspace** to remove selected items; the selection store clears afterward to avoid accidental edits on removed entities.【F:src/features/canvas/tools/SelectTool.ts†L107-L117】
20. **Undo/redo design changes** – Use **Ctrl+Z** to step back through create/update/delete actions and **Ctrl+Y** to reapply them; the history store keeps bounded stacks of reversible commands so layout changes remain recoverable.【F:src/core/commands/entityCommands.ts†L7-L88】【F:src/core/commands/entityCommands.ts†L101-L140】【F:src/core/commands/historyStore.ts†L1-L85】
21. **Check calculations after edits** – After moving or resizing, the underlying calculated fields (room volumes/CFM, duct velocity/friction, equipment ratings) remain aligned with current properties, keeping the design balanced.【F:src/features/canvas/entities/roomDefaults.ts†L20-L67】【F:src/features/canvas/entities/ductDefaults.ts†L17-L74】【F:src/features/canvas/entities/equipmentDefaults.ts†L27-L69】
22. **Viewport finishing pass** – Zoom out to overview the system, then reset/fit the view to ensure everything is within the canvas for final review.【F:src/features/canvas/store/viewportStore.ts†L50-L111】【F:src/features/canvas/components/ZoomControls.tsx†L48-L83】
23. **Final clean-up** – Use marquee select plus Delete to remove temporary construction lines, then nudge remaining elements into alignment. The status bar continues to show live cursor coordinates for precise placement.【F:src/features/canvas/tools/SelectTool.ts†L67-L118】【F:src/features/canvas/components/StatusBar.tsx†L1-L70】

This journey exercises every implemented entity type, tool, interaction model, validation path, calculation update, and viewport control needed to draft a basic HVAC layout in the SizeWise canvas.
